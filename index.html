<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>油そば 注文ページ | 文化祭</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --main-black: #161616;
            --main-white: #fff;
            --main-gray: #f3f3f3;
            --accent: #222;
            --radius: 22px;
            --shadow: 0 8px 36px rgba(0,0,0,0.12), 0 1.5px 7px rgba(0,0,0,0.09);
            --danger: #d32f2f;
            --success: #388e3c;
        }
        html, body {
            height: 100%; width: 100%; margin: 0; padding: 0;
            font-family: 'Noto Sans JP', 'Segoe UI', Arial, sans-serif;
            background: var(--main-white);
        }
        body { min-height: 100vh; box-sizing: border-box; }
        .hidden { display: none !important; }
        button, .btn {
            font-family: inherit;
            border: none;
            outline: none;
            cursor: pointer;
        }
        .section-title {
            font-size: 1.23em;
            font-weight: bold;
            color: var(--main-black);
            margin-bottom: .6em;
            letter-spacing: .08em;
        }
        /* ======= START画面 ======= */
        .start-cover {
            position: fixed;
            z-index: 3000;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--main-white);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer;
            animation: fadeIn 1s;
            transition: opacity 0.5s;
            overflow: hidden;
        }
        .start-hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            background: #fff;
            padding: 48px 28px 40px 28px;
            border-radius: 38px;
            box-shadow: 0 8px 48px #0001, 0 1.5px 7px #0001;
            border: 2.5px solid #eee;
            animation: popIn 1.1s;
            position: relative;
            pointer-events: none;
        }
        .start-hero::before {
            content: "";
            position: absolute;
            inset: -40px;
            z-index: -1;
            background: radial-gradient(circle 400px at 50% 30%, #bbb 0%, #fff0 80%);
            opacity: 0.17;
            pointer-events: none;
        }
        .start-icon {
            font-size: 3.5em;
            color: var(--main-black);
            text-shadow: 0 4px 16px #bbb2, 0 2px 0 #fff;
            margin-bottom: -14px;
            animation: floating 3s infinite ease-in-out;
            pointer-events: none;
        }
        .touch-image {
            width: 95px;
            height: 95px;
            margin-bottom: -10px;
            margin-top: 10px;
            filter: drop-shadow(0 2px 8px #8886);
            animation: touchPop 1.8s infinite cubic-bezier(.5,0,.5,1);
            pointer-events: none;
            background: none;
            display: block;
        }
        @keyframes touchPop {
            0% { transform: scale(1) translateY(0);}
            10% { transform: scale(1.08) translateY(-5px);}
            20% { transform: scale(1.02) translateY(0);}
            100% { transform: scale(1) translateY(0);}
        }
        @keyframes floating {
            0% { transform: translateY(0);}
            50% { transform: translateY(-16px);}
            100% { transform: translateY(0);}
        }
        .start-message {
            color: #161616;
            font-size: 2.45em;
            font-weight: bold;
            letter-spacing: 0.12em;
            text-shadow: 0 2px 18px #eee, 0 1px 0 #fff;
            user-select: none;
            text-align: center;
            margin-bottom: 18px;
            background: none;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: unset;
            background-clip: unset;
            pointer-events: none;
        }
        .taptoorder-visual {
            font-size: 2.4em;
            font-weight: 700;
            color: #222;
            background: none;
            border-radius: 0;
            padding: 0.38em 0;
            letter-spacing: 0.14em;
            margin-top: 18px;
            margin-bottom: 6px;
            box-shadow: none;
            border: none;
            text-shadow: 0 2px 18px #fff, 0 3px 0 #fff3;
            pointer-events: none;
            transition: none;
        }
        .start-hero .taptoorder-visual {
            margin-top: 0;
        }
        /* ======= 注文画面 ======= */
        #orderBtn {
            position: fixed;
            right: 34px;
            bottom: 36px;
            background: #161616;
            color: #fff;
            border: none;
            border-radius: 44px;
            font-size: 1.2em;
            padding: 22px 54px;
            box-shadow: 0 6px 24px #2224, 0 1.5px 7px #2223;
            cursor: pointer;
            z-index: 1300;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 18px;
            opacity: 0.93;
            transition: background 0.2s, box-shadow 0.2s, transform 0.08s, opacity 0.2s;
        }
        #orderBtn:disabled {
            background: #ccc;
            color: #fff;
            opacity: 0.6;
            cursor: not-allowed;
        }
        #orderBtn span {
            font-size: 1.11em;
            font-weight: bold;
        }
        #orderBtn:active {
            background: #444;
            color: #fff;
            transform: scale(0.97);
        }
        #orderBtnTotal {
            font-size: 1.08em;
            font-weight: bold;
            margin-left: 10px;
        }
        .container {
            max-width: 410px;
            margin: 72px auto 0 auto;
            padding: 38px 18px 82px 18px;
            background: #fff;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            min-height: 350px;
            text-align: center;
            position: relative;
            animation: fadeInUp 0.9s;
        }
        .main-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #161616;
            margin-bottom: 24px;
            letter-spacing: 0.06em;
            text-shadow: 0 2px 8px #eee;
        }
        .items-area {
            display: flex;
            flex-direction: column;
            gap: 26px;
            margin-bottom: 30px;
        }
        .item-btns {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .item-btn {
            width: 88%;
            margin: 0 auto;
            font-size: 1.3em;
            padding: 1.1em 0;
            border: none;
            border-radius: 17px;
            background: #f3f3f3;
            color: #161616;
            cursor: pointer;
            box-shadow: 0 2px 22px #0001, 0 1.5px 7px #2222;
            font-weight: bold;
            letter-spacing: 0.08em;
            position: relative;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s, box-shadow 0.25s, transform 0.09s, color 0.2s;
        }
        .item-btn.selected, .item-btn:focus {
            background: #222;
            color: #fff;
            box-shadow: 0 8px 32px #0002, 0 1.5px 7px #2223;
            transform: translateY(-2px) scale(1.03);
        }
        .item-btn .item-controls {
            display: flex;
            align-items: center;
            gap: 7px;
            margin-right: 14px;
        }
        .item-btn .item-count {
            font-size: 1.1em;
            background: #eee;
            color: #222;
            border-radius: 12px;
            min-width: 2.1em;
            text-align: center;
            margin: 0 6px;
            padding: 2px 10px;
            font-weight: bold;
            display: inline-block;
        }
        .item-btn.selected .item-count {
            background: #fff;
            color: #222;
        }
        .item-btn .item-plus,
        .item-btn .item-minus {
            background: #222;
            color: #fff;
            border: none;
            border-radius: 50%;
            font-size: 1.1em;
            width: 1.7em; height: 1.7em;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.18s, color 0.18s;
        }
        .item-btn .item-plus:active, .item-btn .item-minus:active {
            background: #888;
        }
        .item-btn .item-minus:disabled {
            background: #aaa;
            cursor: not-allowed;
        }
        .item-btn .item-price {
            font-size: 0.95em;
            color: #555;
            margin-left: 16px;
            font-weight: normal;
            background: #fff3;
            border-radius: 10px;
            padding: 3px 14px;
        }
        .item-btn.selected .item-price {
            color: #eee;
            background: #2223;
        }
        /* ======= 注文確認モーダル ======= */
        #confirmModal {
            display: none;
            position: fixed; z-index: 2000;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.18);
            align-items: center; justify-content: center;
        }
        #confirmBox {
            background: #232526;
            border-radius: 17px;
            padding: 2.2em 2em;
            min-width: 220px;
            text-align: center;
            box-shadow: var(--shadow);
            color: #fff;
            animation: fadeInUp 0.6s;
        }
        #confirmOrderList {
            text-align: left;
            margin-bottom: 1.3em;
        }
        .confirm-total {
            font-size: 1.11em;
            color: #fff;
            margin-top: 12px;
            font-weight: bold;
            letter-spacing: 0.05em;
        }
        .confirm-btn {
            margin: 18px 16px 0 16px;
            font-size: 1.06em;
            padding: 11px 34px;
            border: none;
            border-radius: 9px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 1px 5px #0002;
            transition: background 0.15s, color 0.15s;
        }
        .confirm-btn.ok { background: #161616; color: #fff; }
        .confirm-btn.ok:hover { background: #444; color: #fff;}
        .confirm-btn.cancel { background: #fff; color: #222; }
        .confirm-btn.cancel:hover { background: #eee; color: #222; }
        /* ======= 注文完了 ======= */
        #orderSuccess {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.18);
            z-index: 2100;
            justify-content: center; align-items: center;
        }
        #orderSuccessBox {
            background: #fff;
            padding: 2.6em 2.8em;
            border-radius: 16px;
            font-size: 1.23em;
            text-align: center;
            box-shadow: var(--shadow);
            animation: popIn 0.55s;
            color: #222;
        }
        #orderSuccessCallNum {
            font-size: 2.5em;
            color: #222;
            font-weight: bold;
            letter-spacing: 0.12em;
            background: #f3f3f3;
            border-radius: 0.6em;
            padding: 0.1em 0.7em;
            border: 3px solid #222;
            box-shadow: 0 2px 16px #0002;
            margin: 0.3em 0 0.8em 0;
            display: inline-block;
        }
        #orderSuccessBox button {
            margin-top: 20px;
            font-size: 1em;
            padding: 10px 32px;
            border: none;
            border-radius: 8px;
            background: #222;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 2px 7px #0001;
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
        }
        #orderSuccessBox button:hover { background: #444; color: #fff; }
        /* ======= 店員用メニュー ======= */
        #openConfirmPageBtn {
            position: fixed;
            top: 18px;
            right: 18px;
            z-index: 4100;
            padding: 7px 16px 7px 11px;
            font-size: 1em;
            background: var(--main-white);
            color: var(--main-black);
            border: 1.5px solid #aaa;
            border-radius: 999px;
            box-shadow: 0 2px 10px #0001;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.92;
            transition: opacity 0.18s, background 0.18s, color 0.18s, border 0.13s;
            display: flex;
            align-items: center;
            gap: 0.3em;
        }
        #openConfirmPageBtn.hide { display: none !important; }
        #openConfirmPageBtn:hover {
            background: var(--main-black);
            color: var(--main-white);
            border: 1.5px solid var(--main-black);
            opacity: 1;
        }
        #stopOrderBtn {
            position: fixed;
            top: 18px;
            left: 18px;
            z-index: 4100;
            padding: 7px 13px 7px 11px;
            font-size: 1em;
            background: var(--main-white);
            color: #d32f2f;
            border: 1.5px solid #d32f2f;
            border-radius: 999px;
            box-shadow: 0 2px 10px #0001;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.93;
            transition: opacity 0.18s, background 0.18s, color 0.18s, border 0.13s;
            display: none;
            align-items: center;
            gap: 0.3em;
        }
        #stopOrderBtn.show { display: flex; }
        #stopOrderBtn:hover {
            background: #d32f2f;
            color: var(--main-white);
            opacity: 1;
            border: 1.5px solid #d32f2f;
        }
        /* ======= 店員用ページセレクト ======= */
        #staffSelectModal {
            display: none;
            position: fixed; z-index: 3500;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.14);
            align-items: center; justify-content: center;
        }
        #staffSelectBox {
            background: #fff;
            border-radius: 18px;
            padding: 2.4em 2.2em 2.4em 2.2em;
            min-width: 250px;
            text-align: center;
            box-shadow: var(--shadow);
            animation: fadeInUp 0.6s;
        }
        .staff-menu-btn {
            margin: 14px 0 0 0;
            font-size: 1.13em;
            padding: 13px 40px;
            border: none;
            border-radius: 12px;
            background: #232526;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 2px 7px #0001;
            cursor: pointer;
            transition: background 0.16s, color 0.16s;
            display: block;
            width: 100%;
        }
        .staff-menu-btn:last-child { margin-bottom: 0; }
        .staff-menu-btn:hover { background: #444; color: #fff; }
        /* ======= 店員用（注文一覧） ======= */
        #staffPage {
            display: none;
            min-height: 100vh;
            width: 100vw;
            background: #fff;
            position: absolute;
            top: 0; left: 0;
            z-index: 4000;
            animation: fadeIn 0.5s;
        }
        .staff-content {
            max-width: 480px;
            margin: 0 auto;
            padding: 48px 10px 44px 10px;
            color: #222;
            text-align: center;
            min-height: 100vh;
            position: relative;
        }
        .staff-title {
            font-size: 1.45em;
            font-weight: bold;
            letter-spacing: 0.06em;
            margin-bottom: 1.5em;
            color: #161616;
            text-shadow: 0 2px 8px #eee;
        }
        .staff-list {
            margin-bottom: 2em;
            text-align: left;
            color: #232526;
            font-size: 1.1em;
            min-height: 135px;
        }
        .staff-list-order {
            background: #f3f3f3;
            border-radius: 13px;
            margin-bottom: 14px;
            padding: 1.1em 1em 0.6em 1em;
            box-shadow: 0 1px 6px #0001;
        }
        .staff-list-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6em;
        }
        .staff-list-order-callnum {
            font-weight: bold;
            font-size: 1.1em;
            background: #161616;
            color: #fff;
            border-radius: 14px;
            padding: 5px 16px;
            margin-right: 10px;
            letter-spacing: 0.11em;
        }
        .staff-list-order-time {
            color: #888;
            font-size: 0.98em;
            margin-left: 8px;
        }
        .staff-list-order-items {
            margin-bottom: 0.6em;
        }
        .staff-list-order-items li {
            margin-bottom: 0.15em;
        }
        .staff-list-order-status {
            color: #fff;
            background: #222;
            border-radius: 9px;
            padding: 2px 13px;
            font-size: 0.96em;
            font-weight: bold;
            display: inline-block;
            margin-left: 7px;
        }
        .staff-list-order[data-status="done"] .staff-list-order-status {
            background: #bbb;
            color: #fff;
        }
        .staff-list-order[data-status="done"] {
            opacity: 0.55;
            text-decoration: line-through;
        }
        .staff-list-order-expire {
            font-size: 0.95em;
            color: #d32f2f;
            margin-left: 1.2em;
            font-weight: normal;
            background: #fff;
            padding: 2px 10px;
            border-radius: 9px;
            vertical-align: middle;
        }
        .staff-note {
            color: #666;
            font-size: 0.93em;
            margin-bottom: 1.1em;
            text-align: left;
        }
        .staff-close-btn, .staff-refresh-btn {
            margin-top: 10px;
            font-size: 1.08em;
            padding: 9px 28px;
            border: none;
            border-radius: 8px;
            background: #222;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 2px 7px #0001;
            cursor: pointer;
            transition: background 0.16s, color 0.16s;
            margin-right: 10px;
        }
        .staff-close-btn:hover, .staff-refresh-btn:hover { background: #444; color: #fff; }
        /* ======= 店員呼出 ======= */
        #staffCallPage {
            display: none;
            min-height: 100vh;
            width: 100vw;
            background: #fff;
            position: absolute;
            top: 0; left: 0;
            z-index: 4000;
            animation: fadeIn 0.5s;
        }
        .staff-call-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 48px 10px 30px 10px;
            color: #222;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .call-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.1em;
        }
        .call-menu-title {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--main-black);
            letter-spacing: .08em;
        }
        .call-menu-close-btn {
            background: var(--main-black);
            color: #fff;
            border-radius: 10px;
            padding: 8px 28px;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 2px 8px #0002;
            transition: background 0.18s;
        }
        .call-menu-close-btn:hover { background: #444; }
        .call-columns {
            display: flex;
            flex-direction: row;
            gap: 32px;
            justify-content: center;
            align-items: flex-start;
        }
        @media (max-width: 850px) {
            .call-columns { flex-direction: column; gap: 20px;}
            .call-col {width: 100%;}
        }
        .call-col {
            width: 380px;
            min-width: 220px;
            flex: 1;
            background: var(--main-gray);
            border-radius: 18px;
            box-shadow: 0 1px 10px #0001;
            padding: 24px 18px 20px 18px;
            margin-bottom: 0;
        }
        .section-title {
            text-align: center;
        }
        .call-number-list {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            align-items: flex-start;
            min-height: 60px;
        }
        .call-number-btn {
            min-width: 80px;
            min-height: 60px;
            font-size: 2em;
            font-weight: bold;
            background: var(--main-white);
            color: var(--main-black);
            border: 2.5px solid var(--main-black);
            border-radius: 17px;
            margin-bottom: 8px;
            box-shadow: 0 2px 11px #0002;
            transition: 
                background 0.15s, color 0.15s, border 0.13s, box-shadow 0.13s;
            position: relative;
            cursor: default;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .call-number-btn:active {
            background: #eee;
        }
        .call-number-btn.clearing {
            background: var(--danger);
            color: #fff;
            border: 2.5px solid var(--danger);
            animation: fadeBlink 0.8s linear infinite alternate;
            cursor: pointer;
        }
        .call-number-btn.clearing::after {
            content: "取消";
            font-size: 0.65em;
            color: #fff;
            position: absolute;
            bottom: 6px; right: 10px;
            background: #d32f2f88;
            border-radius: 7px;
            padding: 2px 7px;
            font-weight: normal;
            letter-spacing: .06em;
        }
        @keyframes fadeBlink {
            0% { box-shadow: 0 0 8px #d32f2f77;}
            100% { box-shadow: 0 0 16px #d32f2f;}
        }
        .call-number-btn.called {
            background: var(--success);
            color: #fff;
            border: 2.5px solid var(--success);
            cursor: pointer;
        }
        .call-number-empty-msg {
            color: #aaa;
            font-size: 1.07em;
            text-align: center;
            margin-top: 1.3em;
        }
        @media (max-width: 600px) {
            .container { margin: 0; border-radius: 0; min-height: 100vh;}
            #orderBtn { right: 8px; bottom: 14px; padding: 18px 15vw;}
            .start-message { font-size: 1.5em; }
            .staff-content { padding: 24px 2vw 24px 2vw;}
            .staff-call-content {padding: 24px 2vw 24px 2vw;}
            .call-col { padding: 14px 6px 14px 6px;}
            .call-number-btn { min-width: 64px; min-height: 48px; font-size: 1.4em;}
        }
        @keyframes fadeIn { 0% { opacity: 0;} 100% { opacity: 1;} }
        @keyframes fadeInUp { 0% { opacity: 0; transform: translateY(30px);} 100% { opacity: 1; transform: translateY(0);} }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.91);} 80% { opacity: 1; transform: scale(1.04);} 100% { opacity: 1; transform: scale(1);}
        }
    </style>
</head>
<body>
    <!-- 右上 店員用ページボタン（呼出管理画面では非表示） -->
    <button id="openConfirmPageBtn" onclick="showStaffSelectModal(event)">
        店員用
    </button>
    <!-- 左上 注文取消ボタン -->
    <button id="stopOrderBtn" onclick="stopOrderClick()">
        注文取消
    </button>
    <!-- スタート画面 -->
    <div class="start-cover" id="startCover" onclick="startOrder(event)">
        <div class="start-hero">
            <!-- タッチ画像を追加 -->
            <img src="touch.jpeg" alt="タップしてください" class="touch-image" />
            <div class="taptoorder-visual">Tap to Order</div>
            <div class="start-message"><span style="font-size:0.65em;font-weight:normal;display:block;letter-spacing:0;">油そば文化祭</span></div>
        </div>
    </div>
    <!-- 注文画面 -->
    <div class="container" id="mainContent" style="display:none;">
        <div class="main-title">ご注文の商品をお選びください</div>
        <div class="items-area">
            <div class="item-btns">
                <div class="item-btn" id="btn-nami">
                    油そば（並）
                    <span class="item-price">¥600</span>
                    <span class="item-controls">
                        <button class="item-minus" onclick="changeItem('並',-1,event)" disabled>-</button>
                        <span class="item-count" id="count-nami"></span>
                        <button class="item-plus" onclick="changeItem('並',1,event)">+</button>
                    </span>
                </div>
                <div class="item-btn" id="btn-oomori">
                    油そば（大盛）
                    <span class="item-price">¥800</span>
                    <span class="item-controls">
                        <button class="item-minus" onclick="changeItem('大盛',-1,event)" disabled>-</button>
                        <span class="item-count" id="count-oomori"></span>
                        <button class="item-plus" onclick="changeItem('大盛',1,event)">+</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <!-- 注文ボタン -->
    <button id="orderBtn" onclick="openConfirm()" disabled>
        注文 <span id="orderBtnCount"></span>
        <span id="orderBtnTotal"></span>
    </button>
    <!-- 注文確認モーダル -->
    <div id="confirmModal">
        <div id="confirmBox">
            <div style="font-size:1.15em;font-weight:bold;margin-bottom:0.8em;">注文内容の確認</div>
            <div id="confirmOrderList"></div>
            <div class="confirm-total" id="confirmTotal"></div>
            <button class="confirm-btn ok" onclick="order()">注文</button>
            <button class="confirm-btn cancel" onclick="closeConfirm()">キャンセル</button>
        </div>
    </div>
    <!-- 注文完了 -->
    <div id="orderSuccess">
        <div id="orderSuccessBox">
            <div id="orderSuccessCallNum"></div>
            <div style="font-size:2.2em; margin-bottom:0.7em;"></div>
            ご注文ありがとうございました！
            <br>
            <span style="display:block;margin-top:0.7em;color:#222;font-size:1.05em;">こちらの呼出番号でお呼びします</span>
            <button onclick="closeSuccess()">閉じる</button>
        </div>
    </div>
    <!-- 注文取消確認ポップアップ -->
    <div id="stopOrderConfirmModal" style="display:none;position:fixed;z-index:5000;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);align-items:center;justify-content:center;">
      <div style="background:#fff;padding:2em 2.2em;border-radius:15px;box-shadow:0 8px 36px #0002;text-align:center;animation:popIn 0.36s;">
        <div style="font-size:1.12em;font-weight:bold;margin-bottom:1em;color:#222;">本当に注文を取り消しますか？</div>
        <button onclick="confirmStopOrder()" style="background:#d32f2f;color:#fff;border:none;padding:0.7em 2.2em;border-radius:8px;font-weight:bold;margin:0 10px 0 0;cursor:pointer;">はい</button>
        <button onclick="closeStopOrderConfirm()" style="background:#eee;color:#222;border:none;padding:0.7em 2.2em;border-radius:8px;font-weight:bold;cursor:pointer;">キャンセル</button>
      </div>
    </div>
    <!-- 店員用ページセレクト -->
    <div id="staffSelectModal">
        <div id="staffSelectBox">
            <div style="font-size:1.15em;font-weight:bold;margin-bottom:1.1em;">店員用メニュー</div>
            <button class="staff-menu-btn" onclick="showStaffPage()">注文一覧</button>
            <button class="staff-menu-btn" onclick="showStaffCallPage()">呼出用</button>
            <button class="staff-menu-btn" onclick="closeStaffSelectModal()">キャンセル</button>
        </div>
    </div>
    <!-- 店員用ページ（注文一覧） -->
    <div id="staffPage">
        <div class="staff-content">
            <div class="staff-title">注文確認ページ</div>
            <div class="staff-note">
                店員用：注文一覧を表示・注文済みにできます。<br>
                <span style="color:#222;">※注文済みにしたい注文をタップしてください。再度タップで未完了に戻せます。</span>
            </div>
            <div>
                <button class="staff-refresh-btn" onclick="renderStaffList(true)">手動更新</button>
            </div>
            <div class="staff-list" id="staffList"></div>
            <button class="staff-close-btn" onclick="hideStaffPage()">閉じる</button>
        </div>
    </div>
    <!-- 店員呼出用ページ -->
    <div id="staffCallPage">
        <div class="staff-call-content">
            <div class="call-menu-header">
                <div class="call-menu-title">呼出管理</div>
                <button class="call-menu-close-btn" onclick="hideStaffCallPage()">閉じる</button>
            </div>
            <div class="call-columns">
                <div class="call-col">
                    <div class="section-title">注文済み番号</div>
                    <div class="call-number-list" id="callWaitList"></div>
                </div>
                <div class="call-col">
                    <div class="section-title">呼出済み番号</div>
                    <div class="call-number-list" id="callCalledList"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // 商品リスト
        const itemTypes = [
            { key: "並", label: "油そば（並）", btn: "btn-nami", count: "count-nami", price: 600 },
            { key: "大盛", label: "油そば（大盛）", btn: "btn-oomori", count: "count-oomori", price: 800 }
        ];
        let selectedItems = { "並": 0, "大盛": 0 };
        let orderHistory = [];
        let currentCallNum = 0;
        let lastOrderCallNum = "";

        function startOrder(e) {
            if (e) e.stopPropagation();
            document.getElementById('startCover').style.opacity = '0';
            document.getElementById('openConfirmPageBtn').classList.add('hide');
            setTimeout(function(){
                document.getElementById('startCover').style.display = 'none';
                document.getElementById('mainContent').style.display = '';
                showStopOrderBtn();
            }, 450);
        }
        function showStopOrderBtn() {
            document.getElementById('stopOrderBtn').classList.add('show');
        }
        function stopOrderClick() {
            showStopOrderConfirm();
        }
        function showStopOrderConfirm() {
            document.getElementById('stopOrderConfirmModal').style.display = 'flex';
        }
        function closeStopOrderConfirm() {
            document.getElementById('stopOrderConfirmModal').style.display = 'none';
        }
        function confirmStopOrder() {
            location.reload();
        }
        // 商品＋−
        function changeItem(type, delta, event) {
            if(event) event.stopPropagation();
            selectedItems[type] += delta;
            if(selectedItems[type] < 0) selectedItems[type] = 0;
            updateItemUI();
            updateOrderBtn();
        }
        function updateItemUI() {
            itemTypes.forEach(item => {
                const cnt = selectedItems[item.key];
                document.getElementById(item.count).textContent = cnt > 0 ? cnt : "";
                const btnEl = document.getElementById(item.btn);
                if(cnt > 0) btnEl.classList.add("selected");
                else btnEl.classList.remove("selected");
                // ボタン有効化
                const minus = btnEl.querySelector('.item-minus');
                minus.disabled = !(cnt > 0);
            });
        }
        function calcTotal() {
            let total = 0;
            itemTypes.forEach(item => total += selectedItems[item.key] * item.price);
            return total;
        }
        function updateOrderBtn() {
            let sum = Object.values(selectedItems).reduce((a,b)=>a+b,0);
            document.getElementById('orderBtnCount').textContent = sum > 0 ? `(${sum})` : "";
            document.getElementById('orderBtn').disabled = sum === 0;
            document.getElementById('orderBtnTotal').textContent = sum > 0 ? `¥${calcTotal().toLocaleString()}` : "";
        }
        function openConfirm() {
            const list = Object.entries(selectedItems).filter(([k,v])=>v>0);
            let html = `<ul style="padding-left:1.1em;">`;
            list.forEach(([k,v])=>{
                html += `<li>${k}：${v}個</li>`;
            });
            html += `</ul>`;
            document.getElementById('confirmOrderList').innerHTML = html;
            document.getElementById('confirmTotal').innerHTML = `合計: ¥${calcTotal().toLocaleString()}`;
            document.getElementById('confirmModal').style.display = 'flex';
        }
        function closeConfirm() {
            document.getElementById('confirmModal').style.display = 'none';
        }
        function getNextCallNumber() {
            let lastNum = Number(localStorage.getItem('aburasoba_order_lastcall') || "0");
            lastNum = isNaN(lastNum) ? 0 : lastNum;
            lastNum += 1;
            localStorage.setItem('aburasoba_order_lastcall', lastNum);
            currentCallNum = lastNum;
            return String(lastNum).padStart(3, '0');
        }
        function order() {
            const callNum = getNextCallNumber();
            lastOrderCallNum = callNum;
            const now = new Date();
            let orderObj = {
                items: {},
                time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                date: now.toLocaleDateString(),
                status: "active",
                callNumber: callNum,
                doneAt: null
            };
            Object.entries(selectedItems).forEach(([type, count])=>{
                if(count > 0){
                    orderObj.items[type] = count;
                }
            });
            orderHistory.push(orderObj);
            localStorage.setItem('aburasoba_order_history', JSON.stringify(orderHistory));
            document.getElementById('confirmModal').style.display = 'none';
            // 呼出番号を表示
            document.getElementById('orderSuccessCallNum').innerHTML = `<div>呼出番号</div><div>${callNum}</div>`;
            document.getElementById('orderSuccessBox').style.display = 'block';
            document.getElementById('orderSuccess').style.display = 'flex';
            selectedItems = { "並": 0, "大盛": 0 };
            updateItemUI();
            updateOrderBtn();
            renderStaffList(true);
        }
        function closeSuccess() {
            document.getElementById('orderSuccess').style.display = 'none';
            location.reload();
        }
        // 店員メニュー
        function showStaffSelectModal(e) {
            if (e) e.stopPropagation();
            document.getElementById('staffSelectModal').style.display = 'flex';
        }
        function closeStaffSelectModal() {
            document.getElementById('staffSelectModal').style.display = 'none';
        }
        function showStaffPage() {
            closeStaffSelectModal();
            document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
            document.getElementById('staffPage').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('startCover').style.display = 'none';
            document.getElementById('staffCallPage').style.display = 'none';
            document.getElementById('openConfirmPageBtn').style.display = ''; // 再表示
            renderStaffList(true);
        }
        function hideStaffPage() {
            document.getElementById('staffPage').style.display = 'none';
            document.getElementById('staffCallPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('startCover').style.display = 'flex';
            document.getElementById('openConfirmPageBtn').classList.remove('hide');
            document.getElementById('openConfirmPageBtn').style.display = '';
            document.getElementById('stopOrderBtn').classList.remove('show');
        }
        function renderStaffList(force) {
            let nowTime = Date.now();
            let saved = localStorage.getItem('aburasoba_order_history');
            if (saved) {
                orderHistory = JSON.parse(saved);
            }
            let changed = false;
            orderHistory = orderHistory.filter(o => {
                if(o.status === "done" && o.doneAt){
                    let timeLeft = 600000 - (nowTime - o.doneAt);
                    if(timeLeft <= 0){
                        changed = true;
                        return false;
                    }
                }
                return true;
            });
            if(changed){
                localStorage.setItem('aburasoba_order_history', JSON.stringify(orderHistory));
            }
            const listDiv = document.getElementById('staffList');
            if (!orderHistory.length) {
                listDiv.innerHTML = '<div style="color:#aaa;text-align:center;">まだ注文履歴がありません</div>';
                return;
            }
            let html = '';
            orderHistory.slice().reverse().forEach((order, idx) => {
                let index = orderHistory.length - 1 - idx;
                let expireText = "";
                if(order.status === "done" && order.doneAt){
                    let left = Math.max(0, 600000 - (nowTime - order.doneAt));
                    let min = Math.ceil(left/60000);
                    if(left > 0){
                        expireText = `<span class="staff-list-order-expire">${min}分後に消去</span>`;
                    }
                }
                let itemsHtml = '<ul class="staff-list-order-items" style="padding-left:1.2em;">';
                let total = 0;
                Object.entries(order.items).forEach(([k,v])=>{
                    const price = itemTypes.find(i=>i.key===k).price;
                    total += price*v;
                    itemsHtml += `<li>${k}：${v}個</li>`;
                });
                itemsHtml += '</ul>';
                html += `
                <div class="staff-list-order" data-status="${order.status||'active'}" onclick="toggleOrderStatus(${index},true)">
                    <div class="staff-list-order-header">
                        <span>
                            <span class="staff-list-order-callnum">#${order.callNumber||'-'}</span>
                            <span class="staff-list-order-status">${order.status==='done'?'注文済み':'未完了'}</span>
                            ${expireText}
                        </span>
                        <span class="staff-list-order-time">${order.date} ${order.time}</span>
                    </div>
                    ${itemsHtml}
                    <div style="text-align:right;font-size:1.06em;margin-bottom:0.2em;font-weight:bold;">合計: ¥${total.toLocaleString()}</div>
                </div>
                `;
            });
            listDiv.innerHTML = html;
        }
        function toggleOrderStatus(index, staffPage) {
            let nowTime = Date.now();
            if (orderHistory[index].status !== "done") {
                orderHistory[index].status = "done";
                orderHistory[index].doneAt = nowTime;
            } else {
                orderHistory[index].status = "active";
                orderHistory[index].doneAt = null;
            }
            localStorage.setItem('aburasoba_order_history', JSON.stringify(orderHistory));
            if(staffPage){
                renderStaffList(true);
            }
        }
        window.toggleOrderStatus = toggleOrderStatus;

        // ===== 呼出管理 =====
        let staffCallClearTimers = {};
        let staffCallClearing = {};
        function showStaffCallPage() {
            closeStaffSelectModal();
            document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
            document.getElementById('staffPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('startCover').style.display = 'none';
            document.getElementById('staffCallPage').style.display = 'block';
            document.getElementById('openConfirmPageBtn').style.display = 'none'; // 店員用ボタンを非表示
            renderStaffCallPage();
            if(window.staffCallInterval) clearInterval(window.staffCallInterval);
            window.staffCallInterval = setInterval(renderStaffCallPage, 10000);
        }
        function hideStaffCallPage() {
            document.getElementById('staffCallPage').style.display = 'none';
            if(window.staffCallInterval) clearInterval(window.staffCallInterval);
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('startCover').style.display = 'flex';
            document.getElementById('openConfirmPageBtn').classList.remove('hide');
            document.getElementById('openConfirmPageBtn').style.display = '';
            document.getElementById('stopOrderBtn').classList.remove('show');
        }
        function getStaffCallNumbers() {
            let orderHistory = [];
            let saved = localStorage.getItem('aburasoba_order_history');
            if (saved) orderHistory = JSON.parse(saved);
            let waitNumbers = [];
            let calledNumbers = [];
            orderHistory.forEach(order => {
                if(order.status === "done") {
                    calledNumbers.push(order.callNumber);
                } else {
                    waitNumbers.push(order.callNumber);
                }
            });
            waitNumbers = [...new Set(waitNumbers)].sort((a,b)=>Number(a)-Number(b));
            calledNumbers = [...new Set(calledNumbers)].sort((a,b)=>Number(a)-Number(b));
            return {waitNumbers, calledNumbers};
        }
        function renderStaffCallPage() {
            const {waitNumbers, calledNumbers} = getStaffCallNumbers();
            // 注文済み番号は押せない
            let waitHTML = '';
            if(waitNumbers.length === 0) {
                waitHTML = `<div class="call-number-empty-msg">待機中の番号はありません</div>`;
            } else {
                waitHTML = waitNumbers.map(num => {
                    return `<span class="call-number-btn">${num}</span>`;
                }).join('');
            }
            document.getElementById('callWaitList').innerHTML = waitHTML;
            // 呼出済み番号は押せる
            let calledHTML = '';
            if(calledNumbers.length === 0) {
                calledHTML = `<div class="call-number-empty-msg">呼出済み番号はありません</div>`;
            } else {
                calledHTML = calledNumbers.map(num => {
                    const clearing = staffCallClearing[num];
                    return `<button class="call-number-btn called${clearing?' clearing':''}" onclick="callNumberClick('${num}', true)">${num}</button>`;
                }).join('');
            }
            document.getElementById('callCalledList').innerHTML = calledHTML;
        }
        function callNumberClick(num, isCalled) {
            if(!isCalled) {
                // 注文済み番号は押せない
                return;
            } else {
                if(staffCallClearing[num]) {
                    clearTimeout(staffCallClearTimers[num]);
                    staffCallClearing[num] = false;
                    renderStaffCallPage();
                } else {
                    staffCallClearing[num] = true;
                    staffCallClearTimers[num] = setTimeout(function(){
                        removeOrder(num);
                        staffCallClearing[num] = false;
                        renderStaffCallPage();
                    }, 3000);
                    renderStaffCallPage();
                }
            }
        }
        function changeOrderStatus(callNumber, status) {
            let orderHistory = [];
            let saved = localStorage.getItem('aburasoba_order_history');
            if (saved) orderHistory = JSON.parse(saved);
            let nowTime = Date.now();
            orderHistory.forEach(order => {
                if(order.callNumber === callNumber && order.status !== status) {
                    order.status = status;
                    order.doneAt = (status==="done") ? nowTime : null;
                }
            });
            localStorage.setItem('aburasoba_order_history', JSON.stringify(orderHistory));
        }
        function removeOrder(callNumber) {
            let orderHistory = [];
            let saved = localStorage.getItem('aburasoba_order_history');
            if (saved) orderHistory = JSON.parse(saved);
            orderHistory = orderHistory.filter(order => !(order.callNumber === callNumber && order.status === "done"));
            localStorage.setItem('aburasoba_order_history', JSON.stringify(orderHistory));
        }
        window.toggleOrderStatus = toggleOrderStatus;
        window.callNumberClick = callNumberClick;
        window.onload = function() {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('orderSuccess').style.display = 'none';
            document.getElementById('startCover').style.opacity = "1";
            document.getElementById('startCover').style.display = 'flex';
            document.getElementById('staffPage').style.display = 'none';
            document.getElementById('staffCallPage').style.display = 'none';
            document.getElementById('staffSelectModal').style.display = 'none';
            document.getElementById('openConfirmPageBtn').classList.remove('hide');
            document.getElementById('openConfirmPageBtn').style.display = '';
            document.getElementById('stopOrderBtn').classList.remove('show');
            let saved = localStorage.getItem('aburasoba_order_history');
            if (saved) {
                orderHistory = JSON.parse(saved);
            }
            selectedItems = {"並":0,"大盛":0};
            updateItemUI();
            updateOrderBtn();
        };
    </script>
</body>
</html>
